{
  "dead_imports": [
    {
      "line": 8,
      "module": "annotations",
      "statement": "from __future__ import annotations"
    }
  ],
  "commented_blocks": [],
  "empty_functions": [],
  "unused_variables": [],
  "all_functions": [
    {
      "name": "create_deepagents_research_agent",
      "line": 182,
      "code": "def create_deepagents_research_agent() -> DeepAgentsTradingAgent:\n    \"\"\"\n    Factory function to create a research agent using deepagents.\n\n    Returns:\n        DeepAgentsTradingAgent configured for research\n    \"\"\"\n    from .agents import create_trading_research_agent\n    deepagent = create_trading_research_agent()\n    return DeepAgentsTradingAgent(agent_name='deepagents-research', deepagent=deepagent, task_prompt_template='Conduct comprehensive research based on the following context:\\n\\n{context_summary}\\n\\nProvide:\\n1. Market analysis\\n2. Sentiment assessment\\n3. Technical indicators\\n4. Risk factors\\n5. Investment recommendation')"
    },
    {
      "name": "create_hybrid_analysis_agent",
      "line": 208,
      "code": "def create_hybrid_analysis_agent(fallback_agent: Optional[TradingAgent]=None) -> HybridTradingAgent:\n    \"\"\"\n    Factory function to create a hybrid analysis agent.\n\n    Args:\n        fallback_agent: Optional fallback agent\n\n    Returns:\n        HybridTradingAgent with deepagent and fallback\n    \"\"\"\n    from .agents import create_market_analysis_agent\n    try:\n        deepagent = create_market_analysis_agent()\n    except Exception as exc:\n        logger.warning(f'Failed to create deepagent: {exc}')\n        deepagent = None\n    return HybridTradingAgent(agent_name='hybrid-analysis', deepagent=deepagent, fallback_agent=fallback_agent)"
    },
    {
      "name": "__init__",
      "line": 26,
      "code": "def __init__(self, agent_name: str, deepagent: Any, task_prompt_template: Optional[str]=None) -> None:\n    \"\"\"\n        Initialize adapter.\n\n        Args:\n            agent_name: Name for the agent\n            deepagent: DeepAgent instance from create_deep_agent\n            task_prompt_template: Optional template for converting context to prompt\n        \"\"\"\n    super().__init__(agent_name)\n    self.deepagent = deepagent\n    self.task_prompt_template = task_prompt_template or 'Analyze the following trading context and provide recommendations:\\n\\n{context_summary}\\n\\nProvide a structured analysis with actionable insights.'"
    },
    {
      "name": "execute",
      "line": 48,
      "code": "def execute(self, context: RunContext) -> AgentResult:\n    \"\"\"\n        Execute deepagent within the TradingAgent framework.\n\n        Args:\n            context: Run context with market data and configuration\n\n        Returns:\n            AgentResult with deepagent's analysis\n        \"\"\"\n    try:\n        market_data = context.state_cache.get('market_data', {})\n        config = context.config.data\n        context_summary = self._build_context_summary(market_data, config)\n        prompt = self.task_prompt_template.format(context_summary=context_summary)\n        result = self.deepagent.invoke({'messages': [{'role': 'user', 'content': prompt}]})\n        response_text = self._extract_response(result)\n        return AgentResult(name=self.agent_name, succeeded=True, payload={'analysis': response_text, 'raw_result': result, 'context_used': context_summary})\n    except Exception as exc:\n        logger.exception(f'DeepAgent {self.agent_name} failed')\n        return AgentResult(name=self.agent_name, succeeded=False, error=str(exc))"
    },
    {
      "name": "_build_context_summary",
      "line": 93,
      "code": "def _build_context_summary(self, market_data: Dict, config: Dict) -> str:\n    \"\"\"Build a summary of context for the deepagent.\"\"\"\n    summary_parts = []\n    if market_data:\n        symbols = list(market_data.get('frames', {}).keys())\n        if symbols:\n            summary_parts.append(f\"Symbols analyzed: {', '.join(symbols)}\")\n    if config:\n        summary_parts.append(f'Configuration: {config}')\n    return '\\n'.join(summary_parts) if summary_parts else 'No specific context provided.'"
    },
    {
      "name": "_extract_response",
      "line": 111,
      "code": "def _extract_response(self, result: Any) -> str:\n    \"\"\"Extract text response from deepagent result.\"\"\"\n    if isinstance(result, dict):\n        if 'messages' in result:\n            messages = result['messages']\n            if messages:\n                last_message = messages[-1]\n                if hasattr(last_message, 'content'):\n                    return str(last_message.content)\n                elif isinstance(last_message, dict) and 'content' in last_message:\n                    return str(last_message['content'])\n    return str(result)"
    },
    {
      "name": "__init__",
      "line": 134,
      "code": "def __init__(self, agent_name: str, deepagent: Optional[Any]=None, fallback_agent: Optional[TradingAgent]=None) -> None:\n    \"\"\"\n        Initialize hybrid agent.\n\n        Args:\n            agent_name: Name for the agent\n            deepagent: Optional deepagent for complex analysis\n            fallback_agent: Fallback agent if deepagent unavailable\n        \"\"\"\n    super().__init__(agent_name)\n    self.deepagent = deepagent\n    self.fallback_agent = fallback_agent"
    },
    {
      "name": "execute",
      "line": 152,
      "code": "def execute(self, context: RunContext) -> AgentResult:\n    \"\"\"\n        Execute with deepagent if available, otherwise use fallback.\n\n        Args:\n            context: Run context\n\n        Returns:\n            AgentResult from deepagent or fallback\n        \"\"\"\n    if self.deepagent:\n        try:\n            adapter = DeepAgentsTradingAgent(agent_name=f'{self.agent_name}_deep', deepagent=self.deepagent)\n            return adapter.execute(context)\n        except Exception as exc:\n            logger.warning(f'Deepagent failed, using fallback: {exc}')\n    if self.fallback_agent:\n        return self.fallback_agent.execute(context)\n    return AgentResult(name=self.agent_name, succeeded=False, error='No agent available (deepagent failed and no fallback)')"
    }
  ]
}
