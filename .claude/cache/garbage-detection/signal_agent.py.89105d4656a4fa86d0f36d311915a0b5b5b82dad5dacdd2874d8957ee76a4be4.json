{
  "dead_imports": [
    {
      "line": 14,
      "module": "np",
      "statement": "import numpy as np"
    }
  ],
  "commented_blocks": [],
  "empty_functions": [],
  "unused_variables": [
    {
      "line": 18,
      "variable": "logger"
    }
  ],
  "all_functions": [
    {
      "name": "__init__",
      "line": 31,
      "code": "def __init__(self):\n    super().__init__(name='SignalAgent', role='Technical analysis and momentum signal generation')"
    },
    {
      "name": "analyze",
      "line": 37,
      "code": "def analyze(self, data: Dict[str, Any]) -> Dict[str, Any]:\n    \"\"\"\n        Generate trading signals from technical analysis.\n        \n        Args:\n            data: Contains price history, volume, technical indicators\n            \n        Returns:\n            Signal analysis with action recommendation\n        \"\"\"\n    symbol = data.get('symbol', 'UNKNOWN')\n    price_data = data.get('price_history', pd.DataFrame())\n    indicators = self._calculate_indicators(price_data)\n    memory_context = self.get_memory_context(limit=3)\n    prompt = f\"You are a Signal Agent analyzing {symbol} technical indicators.\\n\\nTECHNICAL INDICATORS:\\n- Current Price: ${indicators.get('price', 0):.2f}\\n- MACD: {indicators.get('macd', 0):.4f}\\n- MACD Signal: {indicators.get('macd_signal', 0):.4f}\\n- MACD Histogram: {indicators.get('macd_histogram', 0):.4f} ({('BULLISH' if indicators.get('macd_histogram', 0) > 0 else 'BEARISH')})\\n- RSI: {indicators.get('rsi', 50):.2f} ({('OVERBOUGHT' if indicators.get('rsi', 50) > 70 else 'OVERSOLD' if indicators.get('rsi', 50) < 30 else 'NEUTRAL')})\\n- Volume Ratio: {indicators.get('volume_ratio', 1.0):.2f}x average\\n- 50-day MA: ${indicators.get('ma_50', 0):.2f}\\n- 200-day MA: ${indicators.get('ma_200', 0):.2f}\\n- Price vs MA50: {indicators.get('price_vs_ma50', 0):.2%}\\n\\nMOMENTUM ANALYSIS:\\n- Trend: {indicators.get('trend', 'UNKNOWN')}\\n- Momentum Score: {indicators.get('momentum_score', 0):.2f}/100\\n\\n{memory_context}\\n\\nTASK: Provide trading signal analysis:\\n1. Signal Strength (1-10)\\n2. Momentum Direction (BULLISH/BEARISH/NEUTRAL)\\n3. Entry Quality (1-10)\\n4. Recommendation: BUY / SELL / HOLD\\n5. Confidence (0-1)\\n6. Key Technical Factors\\n\\nFormat:\\nSTRENGTH: [1-10]\\nDIRECTION: [BULLISH/BEARISH/NEUTRAL]\\nENTRY_QUALITY: [1-10]\\nRECOMMENDATION: [BUY/SELL/HOLD]\\nCONFIDENCE: [0-1]\\nFACTORS: [key factors]\"\n    response = self.reason_with_llm(prompt)\n    analysis = self._parse_signal_response(response['reasoning'])\n    analysis['indicators'] = indicators\n    analysis['full_reasoning'] = response['reasoning']\n    self.log_decision(analysis)\n    return analysis"
    },
    {
      "name": "_calculate_indicators",
      "line": 104,
      "code": "def _calculate_indicators(self, price_data: pd.DataFrame) -> Dict[str, Any]:\n    \"\"\"\n        Calculate technical indicators from price data.\n        \n        Args:\n            price_data: DataFrame with OHLCV data\n            \n        Returns:\n            Dict of calculated indicators\n        \"\"\"\n    if price_data.empty or len(price_data) < 30:\n        return {'price': 0, 'macd': 0, 'macd_signal': 0, 'macd_histogram': 0, 'rsi': 50, 'volume_ratio': 1.0, 'ma_50': 0, 'ma_200': 0, 'price_vs_ma50': 0, 'trend': 'UNKNOWN', 'momentum_score': 0}\n    close = price_data['Close'] if 'Close' in price_data else price_data['close']\n    volume = price_data['Volume'] if 'Volume' in price_data else price_data['volume']\n    ema_12 = close.ewm(span=12, adjust=False).mean()\n    ema_26 = close.ewm(span=26, adjust=False).mean()\n    macd_line = ema_12 - ema_26\n    signal_line = macd_line.ewm(span=9, adjust=False).mean()\n    histogram = macd_line - signal_line\n    delta = close.diff()\n    gain = delta.where(delta > 0, 0).rolling(window=14).mean()\n    loss = (-delta.where(delta < 0, 0)).rolling(window=14).mean()\n    rs = gain / loss\n    rsi = 100 - 100 / (1 + rs)\n    ma_50 = close.rolling(window=50).mean()\n    ma_200 = close.rolling(window=200).mean() if len(close) >= 200 else ma_50\n    avg_volume = volume.rolling(window=20).mean()\n    volume_ratio = volume.iloc[-1] / avg_volume.iloc[-1] if avg_volume.iloc[-1] > 0 else 1.0\n    current_price = close.iloc[-1]\n    current_macd = macd_line.iloc[-1]\n    current_signal = signal_line.iloc[-1]\n    current_histogram = histogram.iloc[-1]\n    current_rsi = rsi.iloc[-1]\n    current_ma50 = ma_50.iloc[-1]\n    current_ma200 = ma_200.iloc[-1]\n    if current_price > current_ma50 > current_ma200:\n        trend = 'STRONG_UPTREND'\n    elif current_price > current_ma50:\n        trend = 'UPTREND'\n    elif current_price < current_ma50 < current_ma200:\n        trend = 'STRONG_DOWNTREND'\n    elif current_price < current_ma50:\n        trend = 'DOWNTREND'\n    else:\n        trend = 'SIDEWAYS'\n    momentum_score = 0\n    if current_histogram > 0:\n        momentum_score += 30\n    if current_rsi > 50:\n        momentum_score += 20\n    if current_price > current_ma50:\n        momentum_score += 25\n    if volume_ratio > 1.2:\n        momentum_score += 25\n    return {'price': current_price, 'macd': current_macd, 'macd_signal': current_signal, 'macd_histogram': current_histogram, 'rsi': current_rsi, 'volume_ratio': volume_ratio, 'ma_50': current_ma50, 'ma_200': current_ma200, 'price_vs_ma50': (current_price - current_ma50) / current_ma50, 'trend': trend, 'momentum_score': momentum_score}"
    },
    {
      "name": "_parse_signal_response",
      "line": 200,
      "code": "def _parse_signal_response(self, reasoning: str) -> Dict[str, Any]:\n    \"\"\"Parse LLM response into structured signal.\"\"\"\n    lines = reasoning.split('\\n')\n    analysis = {'strength': 5, 'direction': 'NEUTRAL', 'entry_quality': 5, 'action': 'HOLD', 'confidence': 0.5, 'factors': ''}\n    for line in lines:\n        line = line.strip()\n        if line.startswith('STRENGTH:'):\n            try:\n                analysis['strength'] = int(line.split(':')[1].strip())\n            except:\n                pass\n        elif line.startswith('DIRECTION:'):\n            direction = line.split(':')[1].strip().upper()\n            if direction in ['BULLISH', 'BEARISH', 'NEUTRAL']:\n                analysis['direction'] = direction\n        elif line.startswith('ENTRY_QUALITY:'):\n            try:\n                analysis['entry_quality'] = int(line.split(':')[1].strip())\n            except:\n                pass\n        elif line.startswith('RECOMMENDATION:'):\n            rec = line.split(':')[1].strip().upper()\n            if rec in ['BUY', 'SELL', 'HOLD']:\n                analysis['action'] = rec\n        elif line.startswith('CONFIDENCE:'):\n            try:\n                analysis['confidence'] = float(line.split(':')[1].strip())\n            except:\n                pass\n        elif line.startswith('FACTORS:'):\n            analysis['factors'] = line.split(':', 1)[1].strip()\n    return analysis"
    }
  ]
}
