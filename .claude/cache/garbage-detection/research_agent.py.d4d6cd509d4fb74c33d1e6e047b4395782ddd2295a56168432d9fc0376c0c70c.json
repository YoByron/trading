{
  "dead_imports": [],
  "commented_blocks": [],
  "empty_functions": [],
  "unused_variables": [],
  "all_functions": [
    {
      "name": "__init__",
      "line": 39,
      "code": "def __init__(self):\n    super().__init__(name='ResearchAgent', role='Multi-modal fundamental analysis and sentiment')\n    if RAG_AVAILABLE:\n        try:\n            self.retriever = get_retriever()\n            logger.info('RAG retriever initialized for ResearchAgent')\n        except Exception as e:\n            logger.warning(f'Failed to initialize RAG retriever: {e}')\n            self.retriever = None\n    else:\n        self.retriever = None"
    },
    {
      "name": "analyze",
      "line": 55,
      "code": "def analyze(self, data: Dict[str, Any]) -> Dict[str, Any]:\n    \"\"\"\n        Analyze fundamentals, news, and sentiment.\n\n        Args:\n            data: Contains symbol, fundamentals, news, market context\n\n        Returns:\n            Research analysis with investment thesis\n        \"\"\"\n    symbol = data.get('symbol', 'UNKNOWN')\n    fundamentals = data.get('fundamentals', {})\n    market_context = data.get('market_context', {})\n    if self.retriever:\n        try:\n            logger.info(f'Querying RAG database for {symbol} news...')\n            rag_articles = self.retriever.query_rag(query=f'Latest news and analysis for {symbol}', n_results=10, ticker=symbol, days_back=7)\n            news = []\n            for article in rag_articles:\n                news.append({'title': article['metadata'].get('title', article['content'][:100]), 'date': article['metadata'].get('date', 'N/A'), 'sentiment': article['metadata'].get('sentiment', 0.5), 'source': article['metadata'].get('source', 'unknown'), 'relevance': article['relevance_score']})\n            logger.info(f'Retrieved {len(news)} articles from RAG for {symbol}')\n        except Exception as e:\n            logger.warning(f'Failed to query RAG, using fallback news: {e}')\n            news = data.get('news', [])\n    else:\n        news = data.get('news', [])\n    memory_context = self.get_memory_context(limit=3)\n    prompt = f\"You are a Research Agent analyzing {symbol} for trading decision.\\n\\nFUNDAMENTAL DATA:\\n- P/E Ratio: {fundamentals.get('pe_ratio', 'N/A')}\\n- Growth Rate: {fundamentals.get('growth_rate', 'N/A')}\\n- Profit Margin: {fundamentals.get('profit_margin', 'N/A')}\\n- Market Cap: {fundamentals.get('market_cap', 'N/A')}\\n\\nNEWS & SENTIMENT:\\n{self._format_news(news)}\\n\\nMARKET CONTEXT:\\n- Sector: {market_context.get('sector', 'N/A')}\\n- Market Trend: {market_context.get('market_trend', 'N/A')}\\n- Volatility: {market_context.get('volatility', 'N/A')}\\n\\n{memory_context}\\n\\nTASK: Provide a comprehensive analysis:\\n1. Fundamental strength (1-10)\\n2. Sentiment score (-1 to +1)\\n3. Investment thesis (2-3 sentences)\\n4. Recommendation: BUY / SELL / HOLD\\n5. Confidence (0-1)\\n6. Key risks\\n\\nFormat your response as:\\nSTRENGTH: [1-10]\\nSENTIMENT: [-1 to +1]\\nTHESIS: [your thesis]\\nRECOMMENDATION: [BUY/SELL/HOLD]\\nCONFIDENCE: [0-1]\\nRISKS: [key risks]\"\n    response = self.reason_with_llm(prompt)\n    analysis = self._parse_research_response(response['reasoning'])\n    analysis['full_reasoning'] = response['reasoning']\n    self.log_decision(analysis)\n    return analysis"
    },
    {
      "name": "_format_news",
      "line": 154,
      "code": "def _format_news(self, news: list) -> str:\n    \"\"\"Format news items for prompt.\"\"\"\n    if not news:\n        return 'No recent news available.'\n    formatted = ''\n    for i, item in enumerate(news[:5], 1):\n        formatted += f\"{i}. {item.get('title', 'N/A')} ({item.get('date', 'N/A')})\\n\"\n        formatted += f\"   Sentiment: {item.get('sentiment', 'neutral')}\\n\"\n    return formatted"
    },
    {
      "name": "_parse_research_response",
      "line": 168,
      "code": "def _parse_research_response(self, reasoning: str) -> Dict[str, Any]:\n    \"\"\"\n        Parse LLM response into structured analysis.\n\n        Args:\n            reasoning: LLM response text\n\n        Returns:\n            Structured analysis dict\n        \"\"\"\n    lines = reasoning.split('\\n')\n    analysis = {'strength': 5, 'sentiment': 0.0, 'thesis': '', 'action': 'HOLD', 'confidence': 0.5, 'risks': ''}\n    for line in lines:\n        line = line.strip()\n        if line.startswith('STRENGTH:'):\n            try:\n                analysis['strength'] = int(line.split(':')[1].strip())\n            except:\n                pass\n        elif line.startswith('SENTIMENT:'):\n            try:\n                analysis['sentiment'] = float(line.split(':')[1].strip())\n            except:\n                pass\n        elif line.startswith('THESIS:'):\n            analysis['thesis'] = line.split(':', 1)[1].strip()\n        elif line.startswith('RECOMMENDATION:'):\n            rec = line.split(':')[1].strip().upper()\n            if rec in ['BUY', 'SELL', 'HOLD']:\n                analysis['action'] = rec\n        elif line.startswith('CONFIDENCE:'):\n            try:\n                analysis['confidence'] = float(line.split(':')[1].strip())\n            except:\n                pass\n        elif line.startswith('RISKS:'):\n            analysis['risks'] = line.split(':', 1)[1].strip()\n    return analysis"
    }
  ]
}
