{
  "dead_imports": [
    {
      "line": 8,
      "module": "annotations",
      "statement": "from __future__ import annotations"
    }
  ],
  "commented_blocks": [],
  "empty_functions": [],
  "unused_variables": [],
  "all_functions": [
    {
      "name": "get_sentiment_score",
      "line": 22,
      "code": "def get_sentiment_score(symbol: str, sentiment_dir: Optional[Path]=None) -> Optional[float]:\n    \"\"\"\n    Get sentiment score for a symbol from latest sentiment file.\n\n    Args:\n        symbol: Stock ticker symbol (e.g., \"SPY\", \"NVDA\")\n        sentiment_dir: Optional path to sentiment directory (default: data/sentiment)\n\n    Returns:\n        Sentiment score (0-100 scale) or None if not found\n    \"\"\"\n    if sentiment_dir is None:\n        sentiment_dir = DEFAULT_SENTIMENT_DIR\n    if not sentiment_dir.exists():\n        logger.debug(f'Sentiment directory not found: {sentiment_dir}')\n        return None\n    for days_back in range(8):\n        date_str = (datetime.now() - timedelta(days=days_back)).strftime('%Y-%m-%d')\n        sentiment_file = sentiment_dir / f'news_{date_str}.json'\n        if sentiment_file.exists():\n            try:\n                with open(sentiment_file, 'r') as f:\n                    data = json.load(f)\n                tickers = data.get('tickers', {})\n                if symbol in tickers:\n                    ticker_data = tickers[symbol]\n                    score = ticker_data.get('aggregate_score') or ticker_data.get('score')\n                    if score is not None:\n                        logger.debug(f'Found sentiment score for {symbol}: {score} (from {date_str})')\n                        return float(score)\n            except Exception as e:\n                logger.warning(f'Error reading sentiment file {sentiment_file}: {e}')\n                continue\n    logger.debug(f'No sentiment score found for {symbol}')\n    return None"
    },
    {
      "name": "calculate_sentiment_boost",
      "line": 73,
      "code": "def calculate_sentiment_boost(symbol: str, base_amount: float, technical_score: float, sentiment_threshold: float=0.8, boost_multiplier: float=1.2, sentiment_dir: Optional[Path]=None) -> tuple[float, Dict[str, Any]]:\n    \"\"\"\n    Calculate position size boost based on sentiment and technical scores.\n\n    Implements \"The Sentiment Edge\" strategy:\n    - If sentiment > threshold (default 0.8) AND technical_score > 0, boost by multiplier (default 20%)\n\n    Args:\n        symbol: Stock ticker symbol\n        base_amount: Base position size in dollars\n        technical_score: Technical analysis score (0-1 scale)\n        sentiment_threshold: Minimum sentiment score to trigger boost (default: 0.8 = 80%)\n        boost_multiplier: Multiplier to apply when conditions met (default: 1.2 = 20% boost)\n        sentiment_dir: Optional path to sentiment directory\n\n    Returns:\n        Tuple of (adjusted_amount, boost_info_dict)\n    \"\"\"\n    sentiment_score_raw = get_sentiment_score(symbol, sentiment_dir)\n    if sentiment_score_raw is None:\n        return (base_amount, {'boost_applied': False, 'reason': 'No sentiment data available', 'sentiment_score': None, 'technical_score': technical_score, 'base_amount': base_amount, 'adjusted_amount': base_amount})\n    sentiment_score = sentiment_score_raw / 100.0 if sentiment_score_raw > 1.0 else sentiment_score_raw\n    boost_applied = sentiment_score >= sentiment_threshold and technical_score > 0\n    if boost_applied:\n        adjusted_amount = base_amount * boost_multiplier\n        reason = f'Sentiment Edge: sentiment={sentiment_score:.2f} >= {sentiment_threshold} AND technical_score={technical_score:.2f} > 0'\n        logger.info(f'\ud83d\ude80 Sentiment boost applied to {symbol}: ${base_amount:.2f} -> ${adjusted_amount:.2f} (+{(boost_multiplier - 1) * 100:.0f}%)')\n    else:\n        adjusted_amount = base_amount\n        if sentiment_score < sentiment_threshold:\n            reason = f'Sentiment {sentiment_score:.2f} < threshold {sentiment_threshold}'\n        elif technical_score <= 0:\n            reason = f'Technical score {technical_score:.2f} <= 0'\n        else:\n            reason = 'Unknown'\n    return (adjusted_amount, {'boost_applied': boost_applied, 'reason': reason, 'sentiment_score': sentiment_score, 'sentiment_score_raw': sentiment_score_raw, 'technical_score': technical_score, 'base_amount': base_amount, 'adjusted_amount': adjusted_amount, 'boost_multiplier': boost_multiplier if boost_applied else 1.0})"
    }
  ]
}
