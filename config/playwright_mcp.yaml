# Playwright MCP Integration Configuration
# =========================================
# Controls browser automation for sentiment scraping and trade verification

playwright_mcp:
  # Enable/disable the integration
  enabled: true

  # Browser settings
  browser:
    headless: true
    timeout_ms: 30000
    user_agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"

  # Screenshot settings
  screenshots:
    directory: "data/audit_trail/screenshots"
    format: "png"
    full_page: true
    quality: 90  # For JPEG format

  # Audit trail settings
  audit:
    enabled: true
    directory: "data/audit_trail"
    daily_reports: true
    retain_days: 90  # Keep audit files for 90 days

# Sentiment Scraping Configuration
sentiment_scraping:
  # Maximum posts to scrape per source
  max_posts_per_source: 50

  # Scroll depth for loading more content
  scroll_depth: 3

  # Rate limiting (seconds between requests)
  rate_limit_seconds: 1.0

  # Reddit settings
  reddit:
    enabled: true
    subreddits:
      - name: "wallstreetbets"
        weight: 1.0
        category: "meme_stocks"
      - name: "stocks"
        weight: 0.8
        category: "general"
      - name: "investing"
        weight: 0.7
        category: "conservative"
      - name: "options"
        weight: 0.9
        category: "derivatives"
      - name: "stockmarket"
        weight: 0.6
        category: "general"

    # Use old.reddit.com for simpler HTML structure
    use_old_reddit: true

    # Filter criteria
    min_upvotes: 10
    min_comments: 5

  # YouTube settings
  youtube:
    enabled: true
    # Trusted financial channels
    channels:
      - name: "Meet Kevin"
        id: "UCUALwC8dChLpkWHl_JtGnMw"
        weight: 0.8
      - name: "Graham Stephan"
        id: "UCV6KDgJskWaEckne5aPA0aQ"
        weight: 0.7
      - name: "Andrei Jikh"
        id: "UCGy7SkBjcIAgTiwkXEtPnYg"
        weight: 0.7
      - name: "Financial Education"
        id: "UCnMn36GT_H0X-w5_ckLtlgQ"
        weight: 0.6

    # Search settings
    search_enabled: true
    max_results_per_ticker: 10

  # Bogleheads settings
  bogleheads:
    enabled: true
    forums:
      - id: 1
        name: "Investing - Theory, News & General"
        weight: 0.9
      - id: 2
        name: "Help with Personal Investments"
        weight: 0.7

    # Respectful scraping
    rate_limit_seconds: 2.0

# Trade Verification Configuration
trade_verification:
  enabled: true

  # Alpaca settings
  alpaca:
    paper_trading: true

    # URLs for paper trading
    urls:
      login: "https://app.alpaca.markets/login"
      dashboard: "https://app.alpaca.markets/paper/dashboard/overview"
      positions: "https://app.alpaca.markets/paper/dashboard/positions"
      orders: "https://app.alpaca.markets/paper/dashboard/orders"
      account: "https://app.alpaca.markets/paper/dashboard/account"

    # Wait times for page loads (ms)
    page_load_wait_ms: 3000

    # Screenshot on every order verification
    screenshot_orders: true

    # Screenshot positions daily
    daily_position_screenshot: true

  # Verification thresholds
  thresholds:
    # Allow small quantity differences (fractional shares)
    qty_tolerance: 0.01

    # Timeout for finding order in portal (ms)
    order_lookup_timeout_ms: 10000

# Sentiment Analysis Configuration
sentiment_analysis:
  # Keyword-based sentiment (used as fallback)
  keyword_analysis:
    enabled: true

    bullish_keywords:
      - "buy"
      - "bullish"
      - "moon"
      - "rocket"
      - "long"
      - "calls"
      - "breakout"
      - "undervalued"
      - "accumulate"
      - "green"
      - "squeeze"
      - "tendies"
      - "gains"
      - "diamond hands"
      - "hodl"
      - "to the moon"

    bearish_keywords:
      - "sell"
      - "bearish"
      - "short"
      - "puts"
      - "crash"
      - "overvalued"
      - "dump"
      - "red"
      - "loss"
      - "bagholder"
      - "paper hands"
      - "dead cat"
      - "ponzi"
      - "recession"

  # Signal thresholds
  thresholds:
    bullish_threshold: 0.6
    bearish_threshold: 0.6
    min_confidence: 0.5

  # Source weights for aggregation
  source_weights:
    reddit: 0.30
    youtube: 0.25
    bogleheads: 0.25
    news: 0.20

# Integration with Trading Orchestrator
orchestrator_integration:
  # Gate 3: LangChainSentimentAgent enhancement
  sentiment_gate:
    # Use Playwright for dynamic scraping
    use_playwright: true

    # Fallback to API-based scraping if Playwright fails
    fallback_to_api: true

    # Cache sentiment results (minutes)
    cache_duration_minutes: 30

  # Gate 5: Post-execution verification
  execution_verification:
    # Enable web portal verification
    enabled: true

    # Verify all orders or sample
    verify_all: false
    sample_rate: 0.2  # Verify 20% of orders

    # Retry on failure
    max_retries: 2
    retry_delay_seconds: 5
