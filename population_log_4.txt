2025-11-26 16:35:57,275 - src.utils.market_data - INFO - ✅ Alpaca API initialized as PRIMARY market data source (most reliable)
2025-11-26 16:35:57,275 - src.utils.market_data - INFO - ✅ Polygon.io API available as secondary market data source
2025-11-26 16:35:57,275 - src.utils.market_data - INFO - MarketDataProvider configuration (RELIABLE FIRST):
2025-11-26 16:35:57,275 - src.utils.market_data - INFO -   - Alpaca API: ✅ enabled (PRIMARY - most reliable)
2025-11-26 16:35:57,275 - src.utils.market_data - INFO -   - Polygon.io: ✅ enabled (SECONDARY - reliable paid)
2025-11-26 16:35:57,275 - src.utils.market_data - INFO -     * Polygon retries: 3, backoff: 30s (exponential), max_data_age: 48h
2025-11-26 16:35:57,275 - src.utils.market_data - INFO -   - Cache: dir=data/cache/alpha_vantage, ttl=21600s, max_age=7d (FAST FALLBACK)
2025-11-26 16:35:57,275 - src.utils.market_data - INFO -   - yfinance: max_retries=3 (UNRELIABLE FREE - last resort)
2025-11-26 16:35:57,275 - src.utils.market_data - INFO -   - Alpha Vantage: disabled (SLOW RATE-LIMITED - avoid)
2025-11-26 16:35:57,275 - src.utils.data_collector - INFO - DataCollector initialized: data/historical
2025-11-26 16:35:57,275 - src.utils.data_collector - INFO - Collecting data for 4 symbols with 252 days lookback
2025-11-26 16:35:57,275 - src.utils.data_collector - INFO - Fetching data for SPY...
2025-11-26 16:35:57,275 - src.utils.market_data - INFO - SPY: Fetching from Polygon.io API (primary reliable source)
2025-11-26 16:35:57,516 - src.utils.market_data - INFO - SPY: Successfully fetched 120 bars from Polygon.io
2025-11-26 16:35:57,521 - src.utils.market_data - INFO - SPY: ✅ Successfully fetched from Polygon.io (120 rows, 1 attempts, 240.80ms)
2025-11-26 16:35:57,522 - src.utils.data_collector - INFO - Saved 120 rows for SPY to data/historical/SPY_2025-11-26.csv
2025-11-26 16:35:57,522 - src.utils.data_collector - INFO - Fetching data for QQQ...
2025-11-26 16:35:57,523 - src.utils.market_data - INFO - QQQ: Fetching from Polygon.io API (primary reliable source)
2025-11-26 16:35:57,588 - src.utils.market_data - WARNING - QQQ: Polygon.io fetch failed: 429 Client Error: Too Many Requests for url: https://api.polygon.io/v2/aggs/ticker/QQQ/range/1/day/2025-02-02/2025-11-26?adjusted=true&sort=asc&limit=120&apiKey=y2GYaW5d0YFC1eY_lPYcj7peco2rQur1
2025-11-26 16:35:57,646 - src.utils.market_data - WARNING - QQQ: Polygon.io fetch failed: 429 Client Error: Too Many Requests for url: https://api.polygon.io/v2/aggs/ticker/QQQ/range/1/day/2025-02-02/2025-11-26?adjusted=true&sort=asc&limit=120&apiKey=y2GYaW5d0YFC1eY_lPYcj7peco2rQur1
2025-11-26 16:35:57,708 - src.utils.market_data - WARNING - QQQ: Polygon.io fetch failed: 429 Client Error: Too Many Requests for url: https://api.polygon.io/v2/aggs/ticker/QQQ/range/1/day/2025-02-02/2025-11-26?adjusted=true&sort=asc&limit=120&apiKey=y2GYaW5d0YFC1eY_lPYcj7peco2rQur1
2025-11-26 16:35:57,710 - src.utils.market_data - WARNING - QQQ: Polygon.io returned insufficient data, trying Alpaca
2025-11-26 16:35:57,710 - src.utils.market_data - INFO - QQQ: Fetching from Alpaca API (secondary reliable source)
2025-11-26 16:35:57,967 - src.utils.market_data - INFO - QQQ: Successfully fetched 1 bars from Alpaca API
2025-11-26 16:35:57,967 - src.utils.market_data - WARNING - QQQ: Alpaca API returned insufficient data, trying cache/yfinance
2025-11-26 16:35:57,968 - src.utils.market_data - WARNING - QQQ: Paid sources unavailable/unreliable. Trying yfinance (unreliable free source).
2025-11-26 16:35:59,173 - src.utils.market_data - INFO - QQQ: Successfully fetched from yfinance (200 rows, 5 attempts, 1644.54ms)
2025-11-26 16:35:59,174 - src.utils.data_collector - INFO - Saved 200 rows for QQQ to data/historical/QQQ_2025-11-26.csv
2025-11-26 16:35:59,174 - src.utils.data_collector - INFO - Fetching data for VOO...
2025-11-26 16:35:59,174 - src.utils.market_data - INFO - VOO: Fetching from Polygon.io API (primary reliable source)
2025-11-26 16:35:59,230 - src.utils.market_data - WARNING - VOO: Polygon.io fetch failed: 429 Client Error: Too Many Requests for url: https://api.polygon.io/v2/aggs/ticker/VOO/range/1/day/2025-02-02/2025-11-26?adjusted=true&sort=asc&limit=120&apiKey=y2GYaW5d0YFC1eY_lPYcj7peco2rQur1
2025-11-26 16:35:59,287 - src.utils.market_data - WARNING - VOO: Polygon.io fetch failed: 429 Client Error: Too Many Requests for url: https://api.polygon.io/v2/aggs/ticker/VOO/range/1/day/2025-02-02/2025-11-26?adjusted=true&sort=asc&limit=120&apiKey=y2GYaW5d0YFC1eY_lPYcj7peco2rQur1
2025-11-26 16:35:59,386 - src.utils.market_data - WARNING - VOO: Polygon.io fetch failed: 429 Client Error: Too Many Requests for url: https://api.polygon.io/v2/aggs/ticker/VOO/range/1/day/2025-02-02/2025-11-26?adjusted=true&sort=asc&limit=120&apiKey=y2GYaW5d0YFC1eY_lPYcj7peco2rQur1
2025-11-26 16:35:59,392 - src.utils.market_data - WARNING - VOO: Polygon.io returned insufficient data, trying Alpaca
2025-11-26 16:35:59,392 - src.utils.market_data - INFO - VOO: Fetching from Alpaca API (secondary reliable source)
2025-11-26 16:35:59,441 - src.utils.market_data - INFO - VOO: Successfully fetched 1 bars from Alpaca API
2025-11-26 16:35:59,442 - src.utils.market_data - WARNING - VOO: Alpaca API returned insufficient data, trying cache/yfinance
2025-11-26 16:35:59,444 - src.utils.market_data - WARNING - VOO: Paid sources unavailable/unreliable. Trying yfinance (unreliable free source).
2025-11-26 16:36:00,115 - src.utils.market_data - INFO - VOO: Successfully fetched from yfinance (200 rows, 5 attempts, 932.44ms)
2025-11-26 16:36:00,117 - src.utils.data_collector - INFO - Saved 200 rows for VOO to data/historical/VOO_2025-11-26.csv
2025-11-26 16:36:00,117 - src.utils.data_collector - INFO - Fetching data for BND...
2025-11-26 16:36:00,117 - src.utils.market_data - INFO - BND: Fetching from Polygon.io API (primary reliable source)
2025-11-26 16:36:00,207 - src.utils.market_data - INFO - BND: Successfully fetched 120 bars from Polygon.io
2025-11-26 16:36:00,210 - src.utils.market_data - INFO - BND: ✅ Successfully fetched from Polygon.io (120 rows, 1 attempts, 89.35ms)
2025-11-26 16:36:00,211 - src.utils.data_collector - INFO - Saved 120 rows for BND to data/historical/BND_2025-11-26.csv
/Users/igorganapolsky/workspace/git/apps/trading/src/utils/data_collector.py:123: UserWarning: Could not infer format, so each element will be parsed individually, falling back to `dateutil`. To ensure parsing is consistent and as-expected, please specify a format.
  df = pd.read_csv(file, index_col=0, parse_dates=True)
======================================================================
Historical Data Collection for Backtesting
======================================================================

Collecting data for symbols: SPY, QQQ, VOO, BND
Lookback period: 252 days (1 year of trading data)

Note: This requires API keys to be configured.
See docs/ENVIRONMENT_VARIABLES.md for setup instructions.


======================================================================
Data collection complete!
======================================================================

Collected files:

Error during data collection: '<' not supported between instances of 'Timestamp' and 'str'

Troubleshooting:
1. Check that API keys are set in .env file
2. Verify ALPACA_API_KEY and ALPACA_SECRET_KEY are correct
3. Or configure POLYGON_API_KEY for alternative data source
4. See docs/ENVIRONMENT_VARIABLES.md for details
