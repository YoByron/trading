name: EMERGENCY - Close All Crypto Positions

on:
  workflow_dispatch:  # Manual trigger only
    inputs:
      confirm:
        description: 'Type YES to confirm closing all crypto positions'
        required: true
        default: 'NO'

jobs:
  close-crypto:
    runs-on: ubuntu-latest
    if: github.event.inputs.confirm == 'YES'
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install alpaca-py
      
      - name: Close all crypto positions
        env:
          APCA_API_KEY_ID: ${{ secrets.ALPACA_API_KEY }}
          APCA_API_SECRET_KEY: ${{ secrets.ALPACA_SECRET_KEY }}
        run: |
          python scripts/close_all_crypto_positions.py
      
      - name: Report results
        if: always()
        run: |
          echo "âœ… Crypto position closer executed"
          echo "Check logs above for results"
