name: Pre-Merge Verification Gate

on:
  pull_request:
    types: [opened, synchronize, reopened]
    branches: [main]

# THIS IS WHAT IMPROVES RELIABILITY (not quantum computing)
# Blocks ANY PR that would break trading operations

jobs:
  verification-gate:
    name: üîí Verify No Breaking Changes
    runs-on: ubuntu-22.04
    timeout-minutes: 10
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          python3 -m pip install --upgrade pip
          python3 -m pip install -r requirements.txt
      
      - name: üîí RUN VERIFICATION GATE
        run: |
          python3 scripts/pre_merge_verification_gate.py
      
      - name: ‚ùå Block on failure
        if: failure()
        run: |
          echo "::error::üö´ This PR would break trading operations!"
          echo "::error::Fix errors before merging to main."
          exit 1

  syntax-check:
    name: üîç Python Syntax
    runs-on: ubuntu-22.04
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Check syntax
        run: |
          find src scripts -name "*.py" -type f | while read file; do
            python3 -m py_compile "$file" || exit 1
          done
          echo "‚úÖ All Python files have valid syntax"
