name: Immediate Trade Execution

on:
  push:
    branches:
      - 'claude/*'
    paths:
      - 'EXECUTE_NOW.md'

permissions:
  contents: write

jobs:
  trade-now:
    runs-on: ubuntu-22.04
    timeout-minutes: 15
    env:
      ALPACA_API_KEY: ${{ secrets.ALPACA_API_KEY }}
      ALPACA_SECRET_KEY: ${{ secrets.ALPACA_SECRET_KEY }}
      LANGCHAIN_API_KEY: ${{ secrets.LANGCHAIN_API_KEY }}
      LANGCHAIN_PROJECT: 'igor-trading-system'
      LANGCHAIN_TRACING_V2: 'true'
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          pip install alpaca-py yfinance

      - name: Execute Trade NOW
        run: |
          python3 -c "
          import os
          from alpaca.trading.client import TradingClient
          from alpaca.trading.requests import MarketOrderRequest
          from alpaca.trading.enums import OrderSide, TimeInForce

          client = TradingClient(
              os.environ['ALPACA_API_KEY'],
              os.environ['ALPACA_SECRET_KEY'],
              paper=True
          )

          # Get account
          account = client.get_account()
          print(f'Portfolio: \${float(account.equity):,.2f}')
          print(f'Cash: \${float(account.cash):,.2f}')

          # Buy \$500 of SPY
          print('Executing trade: BUY \$500 SPY')
          request = MarketOrderRequest(
              symbol='SPY',
              notional=500,
              side=OrderSide.BUY,
              time_in_force=TimeInForce.DAY,
          )
          order = client.submit_order(request)
          print(f'ORDER SUBMITTED: {order.id}')
          print(f'Status: {order.status}')
          "
